var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _jwtDecode=_interopRequireDefault(require("jwt-decode"));var _base=_interopRequireDefault(require("./base"));var _KindeStorage=_interopRequireDefault(require("./KindeStorage"));var _global$sessionStorag;function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=(0,_getPrototypeOf2["default"])(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2["default"])(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return(0,_possibleConstructorReturn2["default"])(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}var Storage=function(_BaseStore){(0,_inherits2["default"])(Storage,_BaseStore);var _super=_createSuper(Storage);function Storage(){var _this;(0,_classCallCheck2["default"])(this,Storage);_this=_super.call(this);_this.storage=new _KindeStorage["default"]();return _this;}(0,_createClass2["default"])(Storage,[{key:"getToken",value:function(){var _getToken=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee(){var _yield$this$storage$g,password;return _regenerator["default"].wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return this.storage.getItem();case 2:_yield$this$storage$g=_context.sent;password=_yield$this$storage$g.password;return _context.abrupt("return",password?JSON.parse(password):null);case 5:case"end":return _context.stop();}}},_callee,this);}));function getToken(){return _getToken.apply(this,arguments);}return getToken;}()},{key:"setToken",value:function(){var _setToken=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee2(token){return _regenerator["default"].wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:return _context2.abrupt("return",this.storage.setItem(token));case 1:case"end":return _context2.stop();}}},_callee2,this);}));function setToken(_x){return _setToken.apply(this,arguments);}return setToken;}()},{key:"getTokenType",value:function(){var _getTokenType=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee3(type){var _token$newType;var token,newType;return _regenerator["default"].wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return this.getToken();case 2:token=_context3.sent;newType=type==='id_token'?type:'access_token';return _context3.abrupt("return",(_token$newType=token===null||token===void 0?void 0:token[newType])!==null&&_token$newType!==void 0?_token$newType:null);case 5:case"end":return _context3.stop();}}},_callee3,this);}));function getTokenType(_x2){return _getTokenType.apply(this,arguments);}return getTokenType;}()},{key:"getAccessToken",value:function(){var _getAccessToken=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee4(){return _regenerator["default"].wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:return _context4.abrupt("return",this.getTokenType('access_token'));case 1:case"end":return _context4.stop();}}},_callee4,this);}));function getAccessToken(){return _getAccessToken.apply(this,arguments);}return getAccessToken;}()},{key:"getIdToken",value:function(){var _getIdToken=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee5(){return _regenerator["default"].wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:return _context5.abrupt("return",this.getTokenType('id_token'));case 1:case"end":return _context5.stop();}}},_callee5,this);}));function getIdToken(){return _getIdToken.apply(this,arguments);}return getIdToken;}()},{key:"getExpiredAt",value:function(){var _getExpiredAt=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee6(){var token;return _regenerator["default"].wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.next=2;return this.getAccessToken();case 2:token=_context6.sent;return _context6.abrupt("return",token?(0,_jwtDecode["default"])(token)['exp']:0);case 4:case"end":return _context6.stop();}}},_callee6,this);}));function getExpiredAt(){return _getExpiredAt.apply(this,arguments);}return getExpiredAt;}()},{key:"getState",value:function getState(){return this.getItem('state');}},{key:"setState",value:function setState(newState){return this.setItem('state',this.convertString(newState));}},{key:"getCodeVerifier",value:function getCodeVerifier(){return this.getItem('codeVerifier');}},{key:"setCodeVerifier",value:function setCodeVerifier(newCodeVerifier){return this.setItem('codeVerifier',this.convertString(newCodeVerifier));}},{key:"getAuthStatus",value:function getAuthStatus(){return this.getItem('authStatus');}},{key:"setAuthStatus",value:function setAuthStatus(newAuthStatus){return this.setItem('authStatus',this.convertString(newAuthStatus));}},{key:"clearAll",value:function(){var _clearAll=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee7(){return _regenerator["default"].wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:this.clear();return _context7.abrupt("return",this.storage.clear());case 2:case"end":return _context7.stop();}}},_callee7,this);}));function clearAll(){return _clearAll.apply(this,arguments);}return clearAll;}()},{key:"getUserProfile",value:function(){var _getUserProfile=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee8(){var _payload$sub,_payload$given_name,_payload$family_name,_payload$email;var token,payload;return _regenerator["default"].wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_context8.next=2;return this.getIdToken();case 2:token=_context8.sent;payload=token?(0,_jwtDecode["default"])(token):{};return _context8.abrupt("return",{id:(_payload$sub=payload['sub'])!==null&&_payload$sub!==void 0?_payload$sub:'',given_name:(_payload$given_name=payload['given_name'])!==null&&_payload$given_name!==void 0?_payload$given_name:'',family_name:(_payload$family_name=payload['family_name'])!==null&&_payload$family_name!==void 0?_payload$family_name:'',email:(_payload$email=payload['email'])!==null&&_payload$email!==void 0?_payload$email:''});case 5:case"end":return _context8.stop();}}},_callee8,this);}));function getUserProfile(){return _getUserProfile.apply(this,arguments);}return getUserProfile;}()},{key:"convertString",value:function convertString(str){return typeof str==='string'?str:JSON.stringify(str);}}]);return Storage;}(_base["default"]);var sessionStorage=global.sessionStorage=(_global$sessionStorag=global.sessionStorage)!==null&&_global$sessionStorag!==void 0?_global$sessionStorag:new Storage();var _default=sessionStorage;exports["default"]=_default;