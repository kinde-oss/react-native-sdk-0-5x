var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _reactNative=require("react-native");var _urlParse=_interopRequireDefault(require("url-parse"));var _Storage2=_interopRequireDefault(require("../Storage"));var _Utils=require("../Utils");function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=(0,_getPrototypeOf2["default"])(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2["default"])(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return(0,_possibleConstructorReturn2["default"])(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}var AuthorizationCode=function(_Storage){(0,_inherits2["default"])(AuthorizationCode,_Storage);var _super=_createSuper(AuthorizationCode);function AuthorizationCode(){(0,_classCallCheck2["default"])(this,AuthorizationCode);return _super.call(this);}(0,_createClass2["default"])(AuthorizationCode,[{key:"login",value:function(){var _login=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee(kindSDK){var usePKCE,startPage,URLParsed,stateGenerated,challenge,_args=arguments;return _regenerator["default"].wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:usePKCE=_args.length>1&&_args[1]!==undefined?_args[1]:false;startPage=_args.length>2&&_args[2]!==undefined?_args[2]:'login';URLParsed=(0,_urlParse["default"])(kindSDK.authorizationEndpoint,true);URLParsed.query['client_id']=kindSDK.clientId;URLParsed.query['redirect_uri']=kindSDK.redirectUri;URLParsed.query['client_secret']=kindSDK.clientSecret;URLParsed.query['grant_type']='authorization_code';URLParsed.query['scope']=kindSDK.scope;URLParsed.query['start_page']=startPage;URLParsed.query['response_type']='code';stateGenerated=(0,_Utils.generateRandomString)();URLParsed.query['state']=stateGenerated;_context.next=14;return this.setState(stateGenerated);case 14:if(!usePKCE){_context.next=20;break;}challenge=(0,_Utils.generateChallenge)();URLParsed.query['code_challenge']=challenge.codeChallenge;URLParsed.query['code_challenge_method']='S256';_context.next=20;return this.setCodeVerifier(challenge.codeVerifier);case 20:_reactNative.Linking.openURL(URLParsed.toString());case 21:case"end":return _context.stop();}}},_callee,this);}));function login(_x){return _login.apply(this,arguments);}return login;}()}]);return AuthorizationCode;}(_Storage2["default"]);exports["default"]=AuthorizationCode;